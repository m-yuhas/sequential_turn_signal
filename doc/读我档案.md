# 序列性转向灯

## 介绍
在现代的车辆序列性转向灯越来越热门。序列转向灯是一盏段节的转向灯、转向灯激活的时候段节照明根据动
态格局。鉴于这个功能已经内置很多现代车辆，这个项目谋求提供一个简单办法导入这个功能在老爷车、尤其
没有更换现有的转向灯的要求。这个项目的软件与硬件预设为一辆有三盏转向灯在车辆左边和右边的车，但是
如果需要就它们会被适应配合其他位形。

如果您安排安装这个系统在您的车辆里面，请仔细阅读整个指南开始以前还要明白您需要什么工具与技能为完
成这个项目。因为这个系统还没被测试在操作环境中所以它需要高级车辆与电器经验。而且它被设计为一辆特
定车辆、如果您想用它在其他车辆里就需要修改设计。

请参考本地法律对于变更私人车辆开始以前。这个系统也导入序列性性质当刹车灯起初照明，这个功能可否合
法在您本地司法权下。另外请完全明白所有风险：对于自己、对于您的车辆、并且对于那些跟您分享马路的人
。这些风险包括（但是不限于）：电死、火灾、搞砸车辆的布线、并且完成后没有一辆有可用的转向灯和刹车
灯的车辆。请记得套期保值。

## 建立系统
这个系统有三个零件：一块印刷电路板（包含单片机和电子机器）、一个韧体（在单片机执行的）、一个机箱
（为保护系统的功能零件）。每个随着的阶段包括更多详细关于系统的每个零件、怎么建立、还有一些可能变
更。

### 印刷电路板
![下载中。。。](../images/schematic.png)

![下载中。。。](../images/layout.png)

示意图被绘图使用
[EAGLE](https://www.autodesk.com/products/eagle/overview?term=1-YEAR)。示意图会被
调入用这个仓库的pcb目录的档案。这里有建立的步骤：
1. 使用EAGLE为汇出Gerber档案从项目main.brd档案。您会跟随
  [这些从Autodesk的指示](https://www.autodesk.com/products/eagle/blog/gerber-nc-drill-pcb-manufacturing-basics-1/)。
2. 找一个印刷电路板的厂商就把Gerber和Excellon档案发送它为制作。
3. 您应该从厂商获得一块空的印刷电路板。所有的零件被选择为通孔插装技术零件为使生产在家里更容易。
  您需要买所有的零件用在示意图上的型号。
4. 烙铁所有的零件对印刷电路板。

一些要考虑的事项：
1. 这个印刷电路板把右边和左边转向灯信号拦截和分每一个成为三个线、一线一灯。假设三十瓦特刹车灯泡
  就有一些线需要扶持直到2.5安培，因此加宽印刷电路板的线为减少电阻和疏解热性故障风险是推荐的。
2. 电源、接地、输入、输出的连接器都不算车辆等级品。它们被选择作为螺丝连接器为使调试更容易。如果
  可以就使用合适的连接器代替预设连接器。
3. 印刷电路板的布局包含足够空间使用一台环状感应器在开关模式电源里。如果您安排绕自己的感应器就可
  以使用[这个指南](http://www.nessengr.com/technical-data/toroid-inductor-formulas-and-calculator/)
  为算需要多少转。记得选择一条够宽的线位支持至少1安培。

### 软件
![下载中。。。](../images/fsm.png)

两个有限状态机执行在一个MSP430单片机上构成系统的软件零件。每个转向灯有一个有限状态机：当输入信
号线往上时，状态机就开始遍历输出格局向量根据定时器中断。当输入信号线往下时，有限状态机就重启自
己。

这个软件被开发使用德州仪器的[Code Composer Studio](https://www.ti.com/tool/CCSTUDIO)。
您可以载入这个项目用这个仓库的firmware目录的档案。这里有步骤为编译韧体就把二进制文件刷在印刷电
路板上：
1. 买一个[MSP430编程机器](https://www.ti.com/tool/MSP-FET)。
2. 打开这个仓库的firmware目录的Code Composer Studio项目。
3. 连线编程机器对印刷电路板的调试接口。印刷电路板的调试接口使用SBW和UART沟通编程机器。
4. 跟随[Code Composer Studio的说明书](https://www.ti.com/lit/ug/spru509h/spru509h.pdf)
  的详细为刷单片机。
5. 当您提供十二伏特在印刷电路板的电源输入时，MSP430就应该启动。您可以提供十二伏特在左边或者右
  边转向灯信号输入和监控输出的电压为确认它的功能。

一些要考虑的事项：
1. 您可以使用在main.c档案的巨集为定义专门输出格局。
2. 您可以改变main.c档案的TIMER_RESOLUTION_TICKS变量为加速或者减速序列性的格局。
3. 这个项目的MSP430版本只有一个八位元的接口。如果您的车辆有更多转向灯泡比六个（三泡一边），就
  需要选择新的单片机和再设计印刷电路板。

### 机箱
![下载中。。。](../images/top.png)

![下载中。。。](../images/gasket.png)

![下载中。。。](../images/bottom.png)

这个机箱被设计用[OpenSCAD](https://openscad.org/)。这个机箱不防天气、目标仅是提供最少的保
护水平为印刷电路板。因此推荐安装机箱在车辆内部里面。

机箱的计算机辅助设计图纸作为大概攻略。您可以铣自己的金属机箱跟随图纸或者转换图纸为STL档案就3D
打印块们。如果机箱被3D打印的，请确定使用一个可以弄车辆里面热性极限的塑料。

## 安装系统
![下载中。。。](../images/slbd.png)

这个系统有以下的链接跟车辆的布线：
* **电源：** 十二伏特从车辆低压电池。标称这个应该从一条高当系统需要运行时和低当停车长时间时的
  线。缘故是单片机有电源时它就运行、如果车辆停车长时间这个可能会浪费低压电池。
* **接地：** 车辆接地；推荐链接车架。
* **右边转向灯输入：** 车辆原来十二伏特线向右转向灯。
* **左边转向灯输入：** 车辆原来十二伏特线向左转向灯。
* **右边转向灯输出一：** 系统和后内右转向灯泡之间的链接。
* **右边转向灯输出二：** 系统和后中右转向灯泡之间的链接。
* **右边转向灯输出三：** 系统和后外右转向灯泡之间的链接。
* **左边转向灯输出一：** 系统和后内左转向灯泡之间的链接。
* **左边转向灯输出二：** 系统和后中左转向灯泡之间的链接。
* **左边转向灯输出三：** 系统和后外左转向灯泡之间的链接。
